# T004: Write Unit Tests for applyPinnedView Action

**Type**: BE-TEST (Unit Test)
**Priority**: High - validates pinned view application
**State**: pending

---

## Business Summary

Ensure applyPinnedView correctly applies PinnedView object to filter states.

---

## Logic

Test with mock PinnedView object, verify all filter states are set correctly including edge cases.

---

## Technical Logic

Add to `stores/__tests__/useUiStore.test.ts`:

```typescript
describe('useUiStore - applyPinnedView', () => {
  beforeEach(() => {
    // Reset store to initial state before each test
    useUiStore.setState({
      selectedSpaceId: 'all',
      searchQuery: '',
      selectedTag: 'all',
      sortKey: 'newest',
      isFormOpen: false,
      isImportExportOpen: false,
      isSpacesOpen: false,
    });
  });

  it('should apply all properties from PinnedView to store', () => {
    const mockView: PinnedView = {
      id: 'view-1',
      spaceId: 'space-work',
      name: 'Work Items',
      searchQuery: 'urgent',
      tag: 'priority',
      sortKey: 'oldest',
    };

    useUiStore.getState().applyPinnedView(mockView);

    expect(useUiStore.getState().selectedSpaceId).toBe('space-work');
    expect(useUiStore.getState().searchQuery).toBe('urgent');
    expect(useUiStore.getState().selectedTag).toBe('priority');
    expect(useUiStore.getState().sortKey).toBe('oldest');
  });

  it('should handle PinnedView with empty searchQuery', () => {
    const mockView: PinnedView = {
      id: 'view-2',
      spaceId: 'all',
      name: 'All Items',
      searchQuery: '',
      tag: 'all',
      sortKey: 'newest',
    };

    useUiStore.getState().applyPinnedView(mockView);

    expect(useUiStore.getState().selectedSpaceId).toBe('all');
    expect(useUiStore.getState().searchQuery).toBe('');
    expect(useUiStore.getState().selectedTag).toBe('all');
    expect(useUiStore.getState().sortKey).toBe('newest');
  });

  it('should handle PinnedView with "all" tag', () => {
    const mockView: PinnedView = {
      id: 'view-3',
      spaceId: 'space-personal',
      name: 'Personal',
      searchQuery: 'blog',
      tag: 'all',
      sortKey: 'az',
    };

    useUiStore.getState().applyPinnedView(mockView);

    expect(useUiStore.getState().selectedSpaceId).toBe('space-personal');
    expect(useUiStore.getState().searchQuery).toBe('blog');
    expect(useUiStore.getState().selectedTag).toBe('all');
    expect(useUiStore.getState().sortKey).toBe('az');
  });

  it('should not affect overlay states', () => {
    // Set overlay states
    useUiStore.setState({
      isFormOpen: true,
      isSpacesOpen: true,
    });

    const mockView: PinnedView = {
      id: 'view-4',
      spaceId: 'space-123',
      name: 'Test',
      searchQuery: 'test',
      tag: 'test',
      sortKey: 'za',
    };

    useUiStore.getState().applyPinnedView(mockView);

    // Verify filters updated but overlays unchanged
    expect(useUiStore.getState().selectedSpaceId).toBe('space-123');
    expect(useUiStore.getState().isFormOpen).toBe(true);
    expect(useUiStore.getState().isSpacesOpen).toBe(true);
  });
});
```

---

## Testing

Run tests with: `npm test` or project's test command
All tests should pass.

---

## Files

- `stores/__tests__/useUiStore.test.ts` (modify - add new describe block)

---

## Patterns

Follow existing test patterns, use `describe` blocks for action groupings.

---

## Dependencies

- **Blocks**: None
- **Blocked By**: T002

---

## Acceptance Criteria

- [ ] Test cases added to useUiStore.test.ts
- [ ] All 4 test cases pass
- [ ] PinnedView properties correctly mapped to store state
- [ ] Empty strings handled correctly
- [ ] "all" tag handled correctly
- [ ] Overlay states not affected
