# T009: Refactor BookmarkToolbar to Consume Store Directly

**Type**: FE (Component Refactor + Memo)
**Priority**: High - removes prop drilling
**State**: pending

---

## Business Summary

Remove filter props from BookmarkToolbar, read from store instead. Apply React.memo for render optimization.

---

## Logic

Remove filter props, use store selectors inside component, replace onChange callbacks with store actions.

---

## Technical Logic

Update BookmarkToolbar props (components/bookmarks/BookmarkToolbar.tsx:7-21):

Before:
```typescript
interface BookmarkToolbarProps {
  searchQuery: string;
  onSearchChange: (event: React.ChangeEvent<HTMLInputElement>) => void;
  onClearSearch: () => void;
  onClearFilters: () => void;
  tagOptions: string[];
  selectedTag: string;
  onTagChange: (event: React.ChangeEvent<HTMLSelectElement>) => void;
  sortKey: SortKey;
  onSortChange: (event: React.ChangeEvent<HTMLSelectElement>) => void;
  resultsCount: number;
  totalCount: number;
  hasActiveFilters: boolean;
  searchInputRef?: React.RefObject<HTMLInputElement | null>;
}
```

After:
```typescript
interface BookmarkToolbarProps {
  onClearFilters: () => void; // Keep this - it's a composite action
  tagOptions: string[];
  resultsCount: number;
  totalCount: number;
  searchInputRef?: React.RefObject<HTMLInputElement | null>;
}
```

Update component implementation:
```typescript
import { useUiStore } from "@/stores/useUiStore";
import { memo } from "react";

function BookmarkToolbar({
  onClearFilters,
  tagOptions,
  resultsCount,
  totalCount,
  searchInputRef,
}: BookmarkToolbarProps) {
  // Read from store - use individual selectors for granular updates
  const searchQuery = useUiStore((s) => s.searchQuery);
  const selectedTag = useUiStore((s) => s.selectedTag);
  const sortKey = useUiStore((s) => s.sortKey);

  // Store actions
  const setSearchQuery = useUiStore((s) => s.setSearchQuery);
  const setSelectedTag = useUiStore((s) => s.setSelectedTag);
  const setSortKey = useUiStore((s) => s.setSortKey);
  const clearSearch = useUiStore((s) => s.clearSearch);

  const handleSearchChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    setSearchQuery(event.target.value);
  };

  const handleClearSearch = () => {
    clearSearch();
  };

  const handleTagChange = (event: React.ChangeEvent<HTMLSelectElement>) => {
    setSelectedTag(event.target.value);
  };

  const handleSortChange = (event: React.ChangeEvent<HTMLSelectElement>) => {
    setSortKey(event.target.value as SortKey);
  };

  const hasActiveFilters = Boolean(
    searchQuery || selectedTag !== "all" || sortKey !== "newest"
  );

  // Rest of component unchanged...
}

// Apply memo for conservative optimization
export default memo(BookmarkToolbar);
```

Note: Need to add `clearSearch` action to store (or implement inline).

---

## Testing

Manual verification:
- Toolbar displays current filter values
- Filter changes update store
- Toolbar only rerenders when filters change
- No TypeScript errors

---

## Files

- `components/bookmarks/BookmarkToolbar.tsx` (modify)
- `stores/useUiStore.ts` (potentially - add clearSearch action if not exists)

---

## Patterns

Conservative memo approach. Selector-based consumption.

---

## Dependencies

- **Blocks**: None
- **Blocked By**: T008

---

## Acceptance Criteria

- [ ] Filter props removed from BookmarkToolbarProps
- [ ] Store selectors used for filter values
- [ ] onChange handlers call store actions
- [ ] React.memo applied
- [ ] Toolbar functional
- [ ] No TypeScript errors
