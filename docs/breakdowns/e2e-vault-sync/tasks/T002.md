# T002 - Fix Encrypted Push Mode Invariants

**Type**: BE
**State**: pending
**Phase**: Phase A - Server Correctness

## Business Summary
Ensure encrypted push enforces `encrypted=true` and clears `data` column to prevent hybrid rows.

## Logic
Modify `/api/sync/push/route.ts` to explicitly set `encrypted=true` and `data=NULL` on both insert and update operations.

## Technical Logic

### Current Issue
Lines 47-51 (INSERT) and 55-60 (UPDATE) do not enforce mode invariants.

### Changes Required

**INSERT statement (line 47-51)**:
```typescript
// Before:
INSERT INTO records (user_id, record_id, record_type, ciphertext, encrypted, version, deleted)
VALUES ($1, $2, $3, $4, true, 1, $5)

// After: explicitly set data to NULL
INSERT INTO records (user_id, record_id, record_type, ciphertext, encrypted, data, version, deleted)
VALUES ($1, $2, $3, $4, true, NULL, 1, $5)
```

**UPDATE statement (line 55-60)**:
```typescript
// Before:
UPDATE records
SET ciphertext = $1, version = version + 1, deleted = $2, updated_at = NOW()
WHERE id = $3

// After: explicitly clear data and set encrypted=true
UPDATE records
SET ciphertext = $1, encrypted = true, data = NULL, version = version + 1, deleted = $2, updated_at = NOW()
WHERE id = $3
```

## Testing
Backend test - verify after push:
- `encrypted = true`
- `data IS NULL`
- `ciphertext IS NOT NULL`

## Files
- **Modify**: `app/api/sync/push/route.ts`

## Patterns
- Reference existing INSERT/UPDATE structure in same file
- Reference T001 for plaintext counterpart

## Dependencies
- None (can start immediately)
