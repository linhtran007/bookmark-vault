# T017 - Wire Blocked Dialog to Sync Engine

**Type**: FE
**State**: pending
**Phase**: Phase C - Mode Switching Safety

## Business Summary
Show blocked dialog when plaintext sync is blocked by encrypted records, completing the mode switching safety feature.

## Logic
In sync UI, check blocked state from `useSyncEngineUnified` and show `BlockedSyncDialog` when true.

## Technical Logic

### Changes Required

**In sync UI component** (likely in settings or main sync UI):

Find where sync is triggered/integrated and add the dialog:

```typescript
'use client';

import { BlockedSyncDialog } from '@/components/sync/BlockedSyncDialog';
import { useSyncEngine } from '@/hooks/useSyncEngineUnified';

export function SyncSettings() {
  const { canSync, isBlocked, syncPush, syncPull, checkAndSync } = useSyncEngine();
  const [showBlockedDialog, setShowBlockedDialog] = useState(false);

  // Show dialog when blocked state changes
  useEffect(() => {
    if (isBlocked) {
      setShowBlockedDialog(true);
    }
  }, [isBlocked]);

  const handleSync = async () => {
    const result = await checkAndSync();
    // checkAndSync now handles blocking internally via T014
  };

  return (
    <div>
      {/* Existing sync UI */}
      <button onClick={handleSync} disabled={!canSync}>
        Sync Now
      </button>

      {/* Blocked dialog */}
      <BlockedSyncDialog
        open={showBlockedDialog}
        onOpenChange={setShowBlockedDialog}
        onResolved={() => {
          // Re-check sync after resolution
          setShowBlockedDialog(false);
        }}
      />
    </div>
  );
}
```

**Alternatively**, integrate into existing sync status display:
- Show warning icon when `isBlocked` is true
- Click to open blocked dialog

## Testing
FE test:
1. Mock `useSyncEngine` to return `isBlocked=true`
2. Render component
3. Verify dialog shows automatically
4. Click "Revert" → verify dialog closes after success
5. Click "Delete" → verify dialog closes after success

## Files
- **Modify**: Sync UI component (find where sync is triggered - likely in settings)
  - Potential locations: `components/settings/SyncSettings.tsx`, `app/page.tsx`, or similar

## Patterns
- Reference T015 for dialog component
- Reference existing sync UI for integration point
- Follow existing modal/dialog patterns

## Dependencies
- T014 (blocked state in hook)
- T015 (dialog component)

## Notes
This completes the mode switching safety feature. The exact integration point depends on where sync UI lives.
