# T015 - Route Handler Tests for Pull Mode Filtering

**Type**: BE
**State**: pending
**Phase**: Phase A - Server Correctness

## Business Summary
Ensure encrypted pull only returns `encrypted=true` records, preventing plaintext data leakage to E2E mode.

## Logic
Review and add explicit `WHERE encrypted = true` filter to encrypted pull endpoint to guarantee mode isolation.

## Technical Logic

### Changes Required

**In `/api/sync/pull/route.ts`**:

Check existing WHERE clause and ensure:
```typescript
WHERE user_id = $1
  AND encrypted = true  -- Must have this filter
  -- Note: may want to include deleted records for sync
```

If `encrypted = true` is missing, add it.

## Testing
Backend test:
1. Insert mixed rows: some `encrypted=true`, some `encrypted=false`
2. Call encrypted pull endpoint
3. Assert: Only `encrypted=true` rows returned
4. Assert: `data` field never populated in response

## Files
- **Modify**: `app/api/sync/pull/route.ts`

## Patterns
- Reference T005 for plaintext counterpart
- Use same pattern as other WHERE clauses in file

## Dependencies
- None (can verify and fix in parallel with T005)

## Notes
This is likely already correct, but verification is important for security guarantees.
