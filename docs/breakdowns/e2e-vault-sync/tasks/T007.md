# T007 - Persist Pulled Ciphertext Using Existing `lib/encrypted-storage.ts`

**Type**: FE
**State**: pending
**Phase**: Phase B - Client E2E Pull/Apply Pipeline

## Business Summary
Support background pull by persisting cloud ciphertext locally even when vault is locked.

## Logic
We already have `lib/encrypted-storage.ts` in the repo (used by vault enable/disable flows). This task should **extend/reuse** that module to also store "pulled-from-server ciphertext records" so that:

- E2E pull can run in the background
- the user can unlock later and apply decrypted data

## Technical Logic
- Add a dedicated storage slot/key (to avoid clobbering any existing encrypted migration storage).
- Persist records keyed by `(recordId, recordType)`.
- Merge behavior: keep the higher `version`.

## Testing
Jest unit test:
- save â†’ load roundtrip
- merge keeps higher version
- clear works

## Files
- **Modify**: `lib/encrypted-storage.ts`

## Patterns
- Reference existing patterns in `lib/storage.ts` and current `lib/encrypted-storage.ts`.

## Dependencies
- T006 (needs returned records to persist)
