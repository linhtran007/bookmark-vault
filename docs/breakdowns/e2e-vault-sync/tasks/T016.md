# T013 - Wire Dialog into Settings/Sync UI + Unified Engine

**Type**: FE
**State**: pending
**Phase**: Phase C - Plaintext Mode Blocking (Decision A)

## Business Summary
Make the blocked sync UX actually show up in the app and allow the user to resolve it.

## Logic
When plaintext sync detects `encryptedRecordCount > 0`, surface a `BlockedSyncDialog` and pause the plaintext operations until the user chooses an action.

## Technical Logic

### Changes Required

- Update `hooks/useSyncEngineUnified.ts` to expose blocked state, including `encryptedRecordCount`.
- Render `components/sync/BlockedSyncDialog.tsx` from whichever UI owns sync settings/status.
- On resolve, re-run the detection check and resume sync.

```typescript
interface DisableRequest {
  action: 'disable' | 'delete-encrypted';  // Add 'delete-encrypted'
  // ... existing fields ...
}

export async function POST(req: Request) {
  // ... existing auth ...

  try {
    const body = await req.json();
    const { action = 'disable' } = body as DisableRequest;

    // NEW: Delete-only mode (doesn't touch vault, just deletes encrypted records)
    if (action === 'delete-encrypted') {
      await query(
        `DELETE FROM records
         WHERE user_id = $1 AND encrypted = true`,
        [userId]
      );

      // Note: We don't delete the vault or update sync_settings in this mode
      // The vault remains in localStorage, sync mode remains unchanged

      return NextResponse.json({
        success: true,
        message: 'Encrypted records deleted',
      });
    }

    // Existing disable flow (action === 'disable')
    // ... existing logic ...
  } catch (error) {
    // ... existing error handling ...
  }
}
```

## Testing
Backend test:
1. Insert encrypted record for user
2. POST with `{action: 'delete-encrypted'}`
3. Verify encrypted record deleted
4. Verify vault NOT deleted (check localStorage/vault-store not affected)
5. Verify sync_settings NOT updated

## Files
- **Modify**: `hooks/useSyncEngineUnified.ts`
- **Modify**: Sync UI component(s) that trigger sync (TBD)

## Patterns
- Reference existing delete logic in same file
- Follow same error handling pattern

## Dependencies
- None (extends existing endpoint)

## Notes
This is the "danger" option - user explicitly requested this, so confirm dialog in T015 is important.
